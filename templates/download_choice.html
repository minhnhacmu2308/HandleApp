<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download File - X·ª≠ l√Ω d·ªØ li·ªáu Excel</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      padding: 40px;
      max-width: 500px;
      width: 100%;
      text-align: center;
    }

    h1 {
      color: #333;
      margin-bottom: 30px;
      font-size: 2.5em;
      font-weight: 300;
    }

    .success-icon {
      font-size: 4em;
      margin-bottom: 20px;
    }

    .message {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      text-align: left;
    }

    .file-info {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      border-left: 4px solid #28a745;
    }

    .file-name {
      font-family: monospace;
      color: #495057;
      font-weight: bold;
    }

    .button-group {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 15px 30px;
      font-size: 1.1em;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      border: none;
    }

    .btn-download {
      background: linear-gradient(45deg, #28a745, #20c997);
      color: white;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    .btn-download:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }

    .btn-skip {
      background: linear-gradient(45deg, #6c757d, #495057);
      color: white;
      box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
    }

    .btn-skip:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
    }

    .warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      font-size: 0.9em;
    }

    .flash-messages {
      margin: 20px 0;
    }

    .flash-message {
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }

    .flash-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .flash-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>‚úÖ X·ª≠ l√Ω th√†nh c√¥ng!</h1>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
      <div class="flash-message {% if category == 'success' %}flash-success{% else %}flash-error{% endif %}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <div class="success-icon">üéâ</div>

    <div class="message">
      <strong>File ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω th√†nh c√¥ng!</strong><br>
      Th√¥ng tin nh·∫°y c·∫£m ƒë√£ ƒë∆∞·ª£c ·∫©n v√† file ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o th∆∞ m·ª•c fileAfterHandle.
    </div>

    <div class="file-info">
      <h3>üìÅ Th√¥ng tin file:</h3>
      <p>File ƒë√£ ƒë∆∞·ª£c l∆∞u v·ªõi t√™n: <span class="file-name">{{ session.get('output_filename', 'N/A') }}</span></p>
    </div>

    <div class="warning">
      <strong>‚ö†Ô∏è L∆∞u √Ω:</strong><br>
      N·∫øu b·∫°n ch·ªçn "Download v√† x√≥a", c·∫£ file g·ªëc v√† file ƒë√£ x·ª≠ l√Ω s·∫Ω b·ªã x√≥a kh·ªèi h·ªá th·ªëng.
    </div>

    <div class="button-group">
      <a class="btn btn-download" onclick="downloadAndCleanup()">
        üì• Download v√† x√≥a file
      </a>
      <a href="{{ url_for('skip_download') }}" class="btn btn-skip">
        ‚ùå B·ªè qua download
      </a>
    </div>

    <div style="margin-top: 30px; color: #6c757d; font-size: 0.9em;">
      <p>üí° File v·∫´n ƒë∆∞·ª£c l∆∞u trong th∆∞ m·ª•c fileAfterHandle n·∫øu b·∫°n b·ªè qua download</p>
    </div>

    <script>
      function downloadAndCleanup() {
        // T·∫°o m·ªôt iframe ·∫©n ƒë·ªÉ download file
        var iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = "{{ url_for('download_and_cleanup') }}";
        document.body.appendChild(iframe);

        // Sau 2 gi√¢y, g·ªçi cleanup v√† redirect
        setTimeout(function () {
          // G·ªçi cleanup
          fetch("{{ url_for('cleanup_after_download') }}")
            .then(function () {
              // Redirect v·ªÅ trang ch√≠nh
              window.location.href = "{{ url_for('index') }}";
            })
            .catch(function () {
              // N·∫øu c√≥ l·ªói, v·∫´n redirect
              window.location.href = "{{ url_for('index') }}";
            });
        }, 2000);
      }
    </script>
  </div>
</body>

</html>